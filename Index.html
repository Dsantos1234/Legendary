<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Alien GTA: Area 51</title>
    <style>
        :root {
            --primary: #22c55e;
            --background: #000033;
            --health: #ff3333;
        }

        * { box-sizing: border-box; }

        body {
            margin: 0;
            padding: 0;
            width: 100vw;
            height: 100vh;
            background: black;
            color: white;
            font-family: system-ui, -apple-system, sans-serif;
            overflow: hidden;
            touch-action: none;
        }

        #game-container {
            width: 100vw;
            height: 100vh;
            position: relative;
            overflow: hidden;
            background: #001a33;
            touch-action: none;
        }

        #game-world {
            position: absolute;
            width: 3000px;
            height: 3000px;
            transform-origin: top left;
        }

        /* Environment Elements */
        .grass {
            position: absolute;
            width: 100%;
            height: 100%;
            background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath fill='%23003300' fill-opacity='0.2' d='M0 0h100v100H0z'/%3E%3Cpath d='M10 10h5v5h-5zM30 10h5v5h-5zM50 10h5v5h-5z' fill='%23004400' fill-opacity='0.3'/%3E%3C/svg%3E");
        }

        .road {
            position: absolute;
            background: #222;
            border: 1px solid #333;
        }

        .building {
            position: absolute;
            background: linear-gradient(135deg, #112244 0%, #223366 100%);
            border: 1px solid var(--primary);
            box-shadow: 0 0 10px rgba(34, 197, 94, 0.2);
        }

        .fence {
            position: absolute;
            background: #334455;
            border: 2px solid var(--primary);
        }

        #player {
            width: 40px;
            height: 40px;
            position: absolute;
            font-size: 30px;
            transform: translate(-50%, -50%);
            z-index: 100;
            transition: transform 0.1s;
            user-select: none;
        }

        .vehicle {
            position: absolute;
            width: 50px;
            height: 80px;
            background: linear-gradient(45deg, #444 0%, #666 100%);
            border-radius: 8px;
            transform: translate(-50%, -50%);
            border: 1px solid #888;
            z-index: 50;
        }

        .guard {
            position: absolute;
            width: 40px;
            height: 40px;
            font-size: 30px;
            transform: translate(-50%, -50%);
            user-select: none;
            z-index: 90;
        }

        .bullet {
            position: absolute;
            width: 6px;
            height: 6px;
            background: yellow;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            z-index: 80;
            box-shadow: 0 0 5px yellow;
        }

        /* HUD Elements */
        #hud {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid var(--primary);
            z-index: 1000;
            pointer-events: none;
        }

        #health-bar {
            width: 150px;
            height: 20px;
            background: #222;
            border: 1px solid var(--primary);
            border-radius: 10px;
            overflow: hidden;
        }

        #health-fill {
            width: 100%;
            height: 100%;
            background: var(--health);
            transition: width 0.3s;
        }

        #wanted-level {
            margin-top: 10px;
            color: red;
        }

        /* Mobile Controls */
        #joystick-area {
            position: fixed;
            bottom: 20px;
            left: 20px;
            width: 150px;
            height: 150px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            border: 2px solid var(--primary);
            z-index: 1000;
            touch-action: none;
        }

        #joystick {
            position: absolute;
            width: 50px;
            height: 50px;
            background: rgba(34, 197, 94, 0.5);
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            pointer-events: none;
        }

        #action-buttons {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .action-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: rgba(34, 197, 94, 0.2);
            border: 2px solid var(--primary);
            color: var(--primary);
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            user-select: none;
            touch-action: none;
        }

        .damage-indicator {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at center, transparent 60%, rgba(255,0,0,0.3) 100%);
            opacity: 0;
            pointer-events: none;
            z-index: 2000;
            transition: opacity 0.3s;
        }

        @media (max-width: 768px) {
            #hud {
                transform: scale(0.8);
                transform-origin: top left;
            }
            
            .action-btn {
                width: 50px;
                height: 50px;
            }
        }
    </style>
</head>
<body>
    <div id="game-container">
        <div id="game-world">
            <div class="grass"></div>
            <!-- Buildings and roads will be generated here -->
        </div>
        <div id="player">üëΩ</div>
    </div>

    <div id="hud">
        <div id="health-bar"><div id="health-fill"></div></div>
        <div id="wanted-level">‚≠ê</div>
    </div>

    <div id="joystick-area">
        <div id="joystick"></div>
    </div>

    <div id="action-buttons">
        <button class="action-btn" id="shoot-btn">üî´</button>
        <button class="action-btn" id="action-btn">üöó</button>
    </div>

    <div class="damage-indicator"></div>

    <script>
        // Game variables
        const gameWorld = document.getElementById('game-world');
        const player = document.getElementById('player');
        const healthFill = document.getElementById('health-fill');
        const damageIndicator = document.createElement('div');
        damageIndicator.className = 'damage-indicator';
        document.body.appendChild(damageIndicator);

        let playerX = 1500;
        let playerY = 1500;
        let playerRotation = 0;
        let playerHealth = 100;
        let playerInVehicle = null;
        let wantedLevel = 1;

        // Environment generation
        function generateEnvironment() {
            // Generate roads
            for (let i = 0; i < 5; i++) {
                const horizontal = document.createElement('div');
                horizontal.className = 'road';
                horizontal.style.width = '100%';
                horizontal.style.height = '60px';
                horizontal.style.top = (i * 600) + 'px';
                gameWorld.appendChild(horizontal);

                const vertical = document.createElement('div');
                vertical.className = 'road';
                vertical.style.width = '60px';
                vertical.style.height = '100%';
                vertical.style.left = (i * 600) + 'px';
                gameWorld.appendChild(vertical);
            }

            // Generate buildings
            const areas = [
                { name: 'Military Base', x: 0, y: 0, width: 1000, height: 1000 },
                { name: 'Research Lab', x: 1500, y: 500, width: 800, height: 800 },
                { name: 'Storage Area', x: 500, y: 1500, width: 600, height: 900 }
            ];

            areas.forEach(area => {
                // Perimeter fence
                const fence = document.createElement('div');
                fence.className = 'fence';
                fence.style.left = area.x + 'px';
                fence.style.top = area.y + 'px';
                fence.style.width = area.width + 'px';
                fence.style.height = area.height + 'px';
                gameWorld.appendChild(fence);

                // Buildings within area
                const numBuildings = Math.floor((area.width * area.height) / 40000);
                for (let i = 0; i < numBuildings; i++) {
                    const building = document.createElement('div');
                    building.className = 'building';
                    building.style.width = Math.random() * 100 + 50 + 'px';
                    building.style.height = Math.random() * 100 + 50 + 'px';
                    building.style.left = (area.x + Math.random() * (area.width - 100)) + 'px';
                    building.style.top = (area.y + Math.random() * (area.height - 100)) + 'px';
                    gameWorld.appendChild(building);
                }
            });
        }

        // Guard AI
        function spawnGuards() {
            const numGuards = 20;
            for (let i = 0; i < numGuards; i++) {
                const guard = document.createElement('div');
                guard.className = 'guard';
                guard.innerHTML = 'üëÆ';
                guard.style.left = Math.random() * gameWorld.offsetWidth + 'px';
                guard.style.top = Math.random() * gameWorld.offsetHeight + 'px';
                gameWorld.appendChild(guard);

                // Guard behavior
                setInterval(() => {
                    if (!isGameRunning) return;
                    
                    const guardRect = guard.getBoundingClientRect();
                    const playerRect = player.getBoundingClientRect();
                    const dx = playerRect.left - guardRect.left;
                    const dy = playerRect.top - guardRect.top;
                    const distance = Math.sqrt(dx * dx + dy * dy);

                    if (distance < 300) { // Detection range
                        // Chase player
                        const angle = Math.atan2(dy, dx);
                        const speed = 2;
                        const newX = parseFloat(guard.style.left) + Math.cos(angle) * speed;
                        const newY = parseFloat(guard.style.top) + Math.sin(angle) * speed;
                        
                        guard.style.left = newX + 'px';
                        guard.style.top = newY + 'px';

                        // Attack if very close
                        if (distance < 50 && !playerInVehicle) {
                            damagePlayer(5);
                        }
                    }
                }, 50);
            }
        }

        function damagePlayer(amount) {
            playerHealth = Math.max(0, playerHealth - amount);
            healthFill.style.width = playerHealth + '%';
            
            // Visual feedback
            damageIndicator.style.opacity = '1';
            setTimeout(() => damageIndicator.style.opacity = '0', 300);

            if (playerHealth <= 0) {
                gameOver();
            }
        }

        // Mobile controls
        const joystickArea = document.getElementById('joystick-area');
        const joystick = document.getElementById('joystick');
        const shootBtn = document.getElementById('shoot-btn');
        const actionBtn = document.getElementById('action-btn');

        let joystickActive = false;
        let joystickCenter = { x: 0, y: 0 };
        let moveVector = { x: 0, y: 0 };

        joystickArea.addEventListener('touchstart', (e) => {
            joystickActive = true;
            const touch = e.touches[0];
            const rect = joystickArea.getBoundingClientRect();
            joystickCenter = {
                x: rect.left + rect.width / 2,
                y: rect.top + rect.height / 2
            };
            updateJoystick(touch);
        });

        document.addEventListener('touchmove', (e) => {
            if (!joystickActive) return;
            updateJoystick(e.touches[0]);
        });

        document.addEventListener('touchend', () => {
            joystickActive = false;
            joystick.style.transform = 'translate(-50%, -50%)';
            moveVector = { x: 0, y: 0 };
        });

        function updateJoystick(touch) {
            const dx = touch.clientX - joystickCenter.x;
            const dy = touch.clientY - joystickCenter.y;
            const distance = Math.min(50, Math.sqrt(dx * dx + dy * dy));
            const angle = Math.atan2(dy, dx);
            
            moveVector = {
                x: Math.cos(angle) * (distance / 50),
                y: Math.sin(angle) * (distance / 50)
            };

            joystick.style.transform = `translate(calc(-50% + ${dx}px), calc(-50% + ${dy}px))`;
        }

        shootBtn.addEventListener('touchstart', shoot);
        actionBtn.addEventListener('touchstart', handleVehicleInteraction);

        // Game loop and other functions remain similar to the previous version
        // [Previous game loop code]

        // Initialize game
        generateEnvironment();
        spawnGuards();
        updateGame();
    </script>
</body>
</html>
[Previous HTML/CSS code remains the same]

<script>
        // Add this to the end of the previous script
        
        let isGameRunning = true;

        function updateGame() {
            if (!isGameRunning) return;

            // Update player position based on controls
            if (joystickActive) {
                const speed = playerInVehicle ? 8 : 5;
                playerX += moveVector.x * speed;
                playerY += moveVector.y * speed;
                
                if (moveVector.x || moveVector.y) {
                    playerRotation = Math.atan2(moveVector.y, moveVector.x) * 180 / Math.PI;
                }
            }

            // Keep player within bounds
            playerX = Math.max(20, Math.min(gameWorld.offsetWidth - 20, playerX));
            playerY = Math.max(20, Math.min(gameWorld.offsetHeight - 20, playerY));

            // Update player position and rotation
            player.style.left = playerX + 'px';
            player.style.top = playerY + 'px';
            player.style.transform = `translate(-50%, -50%) rotate(${playerRotation}deg)`;

            // Update vehicle if player is in one
            if (playerInVehicle) {
                playerInVehicle.style.left = playerX + 'px';
                playerInVehicle.style.top = playerY + 'px';
                playerInVehicle.style.transform = `translate(-50%, -50%) rotate(${playerRotation}deg)`;
            }

            // Camera follow
            const cameraX = playerX - window.innerWidth / 2;
            const cameraY = playerY - window.innerHeight / 2;
            gameWorld.style.transform = `translate(${-cameraX}px, ${-cameraY}px)`;

            // Collision detection with buildings
            const playerRect = player.getBoundingClientRect();
            const buildings = document.querySelectorAll('.building');
            buildings.forEach(building => {
                const buildingRect = building.getBoundingClientRect();
                if (isColliding(playerRect, buildingRect)) {
                    // Push player out of building
                    const overlap = getOverlap(playerRect, buildingRect);
                    if (overlap.x < overlap.y) {
                        playerX += overlap.x * (playerRect.left < buildingRect.left ? -1 : 1);
                    } else {
                        playerY += overlap.y * (playerRect.top < buildingRect.top ? -1 : 1);
                    }
                }
            });

            requestAnimationFrame(updateGame);
        }

        function isColliding(rect1, rect2) {
            return !(rect1.right < rect2.left || 
                    rect1.left > rect2.right || 
                    rect1.bottom < rect2.top || 
                    rect1.top > rect2.bottom);
        }

        function getOverlap(rect1, rect2) {
            const xOverlap = Math.min(rect1.right - rect2.left, rect2.right - rect1.left);
            const yOverlap = Math.min(rect1.bottom - rect2.top, rect2.bottom - rect1.top);
            return { x: xOverlap, y: yOverlap };
        }

        function shoot() {
            if (!isGameRunning || playerInVehicle) return;

            const bullet = document.createElement('div');
            bullet.className = 'bullet';
            bullet.style.left = playerX + 'px';
            bullet.style.top = playerY + 'px';
            gameWorld.appendChild(bullet);

            const angle = (playerRotation * Math.PI) / 180;
            const speed = 15;
            const vx = Math.cos(angle) * speed;
            const vy = Math.sin(angle) * speed;

            function updateBullet() {
                const x = parseFloat(bullet.style.left);
                const y = parseFloat(bullet.style.top);
                
                bullet.style.left = (x + vx) + 'px';
                bullet.style.top = (y + vy) + 'px';

                // Check for collisions with guards
                const bulletRect = bullet.getBoundingClientRect();
                document.querySelectorAll('.guard').forEach(guard => {
                    const guardRect = guard.getBoundingClientRect();
                    if (isColliding(bulletRect, guardRect)) {
                        guard.remove();
                        bullet.remove();
                        increaseWantedLevel();
                    }
                });

                // Remove bullet if out of bounds or hit something
                if (x < 0 || x > gameWorld.offsetWidth || y < 0 || y > gameWorld.offsetHeight) {
                    bullet.remove();
                } else {
                    requestAnimationFrame(updateBullet);
                }
            }
            requestAnimationFrame(updateBullet);
        }

        function handleVehicleInteraction() {
            if (playerInVehicle) {
                // Exit vehicle
                playerInVehicle.style.opacity = '1';
                playerInVehicle = null;
                player.innerHTML = 'üëΩ';
                return;
            }

            // Find nearest vehicle
            const vehicles = document.querySelectorAll('.vehicle');
            let nearestVehicle = null;
            let nearestDistance = Infinity;

            vehicles.forEach(vehicle => {
                const dx = parseFloat(vehicle.style.left) - playerX;
                const dy = parseFloat(vehicle.style.top) - playerY;
                const distance = Math.sqrt(dx * dx + dy * dy);

                if (distance < 100 && distance < nearestDistance) {
                    nearestDistance = distance;
                    nearestVehicle = vehicle;
                }
            });

            if (nearestVehicle) {
                playerInVehicle = nearestVehicle;
                nearestVehicle.style.opacity = '0.5';
                player.innerHTML = 'üöó';
            }
        }

        function increaseWantedLevel() {
            if (wantedLevel < 5) {
                wantedLevel++;
                document.getElementById('wanted-level').textContent = '‚≠ê'.repeat(wantedLevel);
                spawnReinforcements();
            }
        }

        function spawnReinforcements() {
            const numReinforcements = wantedLevel * 2;
            for (let i = 0; i < numReinforcements; i++) {
                const spawnPoint = getRandomSpawnPoint();
                const guard = document.createElement('div');
                guard.className = 'guard';
                guard.innerHTML = 'üëÆ';
                guard.style.left = spawnPoint.x + 'px';
                guard.style.top = spawnPoint.y + 'px';
                gameWorld.appendChild(guard);
            }
        }

        function getRandomSpawnPoint() {
            const margin = 100;
            const angle = Math.random() * Math.PI * 2;
            const distance = 500; // Spawn distance from player
            
            return {
                x: playerX + Math.cos(angle) * distance,
                y: playerY + Math.sin(angle) * distance
            };
        }

        function gameOver() {
            isGameRunning = false;
            const gameOverScreen = document.createElement('div');
            gameOverScreen.style.position = 'fixed';
            gameOverScreen.style.top = '50%';
            gameOverScreen.style.left = '50%';
            gameOverScreen.style.transform = 'translate(-50%, -50%)';
            gameOverScreen.style.background = 'rgba(0,0,0,0.9)';
            gameOverScreen.style.padding = '20px';
            gameOverScreen.style.borderRadius = '10px';
            gameOverScreen.style.textAlign = 'center';
            gameOverScreen.style.zIndex = '2000';
            gameOverScreen.innerHTML = `
                <h2>Game Over!</h2>
                <p>Wanted Level: ${wantedLevel}‚≠ê</p>
                <button onclick="location.reload()" style="padding: 10px 20px; margin-top: 10px; background: var(--primary); border: none; border-radius: 5px; cursor: pointer;">
                    Try Again
                </button>
            `;
            document.body.appendChild(gameOverScreen);
        }

        // Generate vehicles
        function generateVehicles() {
            const vehicleTypes = ['üöó', 'üöô', 'üöê', 'üöõ'];
            for (let i = 0; i < 15; i++) {
                const vehicle = document.createElement('div');
                vehicle.className = 'vehicle';
                vehicle.textContent = vehicleTypes[Math.floor(Math.random() * vehicleTypes.length)];
                vehicle.style.left = Math.random() * (gameWorld.offsetWidth - 100) + 50 + 'px';
                vehicle.style.top = Math.random() * (gameWorld.offsetHeight - 100) + 50 + 'px';
                gameWorld.appendChild(vehicle);
            }
        }

        // Initialize game
        generateEnvironment();
        generateVehicles();
        spawnGuards();
        updateGame();
    </script>
</body>
</html>
