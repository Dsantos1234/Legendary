<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MUB - Area 51 Escape</title>
    <style>
        body { 
            margin: 0; 
            background: #1a1a1a; 
            font-family: system-ui, -apple-system, sans-serif;
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            color: #fff;
            overflow: hidden;
        }
        #game-container { 
            position: relative; 
            width: 800px; 
            height: 400px; 
            background: linear-gradient(#000033, #000066); 
            margin: 20px; 
            overflow: hidden; 
            border: 2px solid #22c55e;
            border-radius: 8px;
        }
        #alien { 
            position: absolute; 
            width: 40px; 
            height: 40px; 
            bottom: 20px; 
            left: 50px; 
            font-size: 30px; 
            line-height: 40px; 
            text-align: center;
            user-select: none;
            z-index: 2;
        }
        .guard { 
            position: absolute; 
            width: 30px; 
            height: 40px;
            right: -30px; 
            font-size: 24px; 
            display: flex; 
            justify-content: center; 
            align-items: center;
            user-select: none;
            z-index: 1;
        }
        .keycard { 
            position: absolute; 
            width: 20px; 
            height: 20px; 
            font-size: 15px; 
            display: flex; 
            justify-content: center; 
            align-items: center;
            user-select: none;
            animation: float 2s ease-in-out infinite;
        }
        #stats { 
            font-size: 24px; 
            margin: 10px;
            text-align: center;
        }
        #game-over { 
            display: none; 
            position: absolute; 
            top: 50%; 
            left: 50%; 
            transform: translate(-50%, -50%); 
            text-align: center; 
            font-size: 32px; 
            color: #ff0000; 
            background: rgba(0,0,0,0.8); 
            padding: 20px;
            border-radius: 8px;
            z-index: 10;
        }
        .btn { 
            padding: 10px 20px; 
            font-size: 18px; 
            background: #22c55e; 
            color: #000;
            border: none; 
            border-radius: 5px; 
            cursor: pointer; 
            margin: 10px;
            transition: background-color 0.2s ease;
        }
        .btn:hover {
            background: #16a34a;
        }
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        @media (max-width: 850px) {
            #game-container {
                width: 95vw;
                max-width: 800px;
            }
            #stats {
                font-size: 18px;
            }
        }
        .instructions {
            text-align: center;
            margin-bottom: 10px;
            font-size: 14px;
            opacity: 0.8;
        }
    </style>
</head>
<body>
    <h1>MUB - Area 51 Escape üëΩ</h1>
    <div class="instructions">
        Use arrow keys to move and jump. Collect keycards üîë and avoid guards üëÆ
    </div>
    <div id="stats">Score: 0 | Keycards: 0/3 | Health: ‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>
    <div id="game-container">
        <div id="alien">üëΩ</div>
        <div id="game-over">
            Captured!<br>
            <button class="btn" onclick="resetGame()">Try Again</button>
        </div>
    </div>
    <button class="btn" onclick="startGame()">Start Escape</button>

    <script>
        const alien = document.getElementById('alien');
        const gameContainer = document.getElementById('game-container');
        const statsElement = document.getElementById('stats');
        const gameOverElement = document.getElementById('game-over');
        let score = 0, keycards = 0, health = 3;
        let isJumping = false;
        let gameInterval, guardInterval, keycardInterval;
        let isGameRunning = false;
        let jumpForce = 0;
        const keys = {};

        // Optimized game loop with requestAnimationFrame
        function gameLoop() {
            if (!isGameRunning) return;

            if (!isJumping && keys.ArrowUp) {
                isJumping = true;
                jumpForce = 15;
            }
            
            if (isJumping) {
                let bottom = parseFloat(alien.style.bottom) || 20;
                jumpForce -= 0.8;
                bottom += jumpForce;
                
                if (bottom <= 20) {
                    bottom = 20;
                    isJumping = false;
                }
                alien.style.bottom = `${bottom}px`;
            }
            
            let left = parseFloat(alien.style.left) || 50;
            if (keys.ArrowLeft && left > 0) left -= 5;
            if (keys.ArrowRight && left < gameContainer.clientWidth - 40) left += 5;
            alien.style.left = `${left}px`;
            
            checkCollisions();
            requestAnimationFrame(gameLoop);
        }

        function createGuard() {
            if (!isGameRunning) return;
            const guard = document.createElement('div');
            guard.className = 'guard';
            guard.innerHTML = 'üëÆ';
            guard.style.bottom = '20px';
            gameContainer.appendChild(guard);
            
            function moveGuard() {
                if (!isGameRunning) {
                    guard.remove();
                    return;
                }
                let left = parseFloat(guard.style.left) || gameContainer.clientWidth;
                if (left < -30) {
                    guard.remove();
                    score += 10;
                    updateStats();
                } else {
                    guard.style.left = `${left - 4}px`;
                    requestAnimationFrame(moveGuard);
                }
            }
            requestAnimationFrame(moveGuard);
        }

        function createKeycard() {
            if (!isGameRunning || keycards >= 3) return;
            const keycard = document.createElement('div');
            keycard.className = 'keycard';
            keycard.innerHTML = 'üîë';
            keycard.style.left = `${Math.random() * (gameContainer.clientWidth - 50) + 50}px`;
            keycard.style.bottom = `${Math.random() * 300 + 50}px`;
            gameContainer.appendChild(keycard);
        }

        function checkCollisions() {
            const alienRect = alien.getBoundingClientRect();
            
            document.querySelectorAll('.guard').forEach(guard => {
                if (isColliding(alienRect, guard.getBoundingClientRect())) {
                    takeDamage();
                }
            });
            
            document.querySelectorAll('.keycard').forEach(keycard => {
                if (isColliding(alienRect, keycard.getBoundingClientRect())) {
                    keycard.remove();
                    keycards++;
                    score += 50;
                    updateStats();
                    if (keycards >= 3) levelComplete();
                }
            });
        }

        function isColliding(rect1, rect2) {
            return !(rect1.right < rect2.left || rect1.left > rect2.right || 
                    rect1.bottom < rect2.top || rect1.top > rect2.bottom);
        }

        function takeDamage() {
            health--;
            updateStats();
            if (health <= 0) {
                endGame();
            } else {
                alien.style.opacity = '0.5';
                setTimeout(() => alien.style.opacity = '1', 200);
            }
        }

        function updateStats() {
            statsElement.textContent = `Score: ${score} | Keycards: ${keycards}/3 | Health: ${'‚ù§Ô∏è'.repeat(health)}`;
        }

        function levelComplete() {
            isGameRunning = false;
            clearInterval(guardInterval);
            clearInterval(keycardInterval);
            alert('Level Complete! You escaped Area 51!');
            endGame();
        }

        function endGame() {
            isGameRunning = false;
            clearInterval(guardInterval);
            clearInterval(keycardInterval);
            gameOverElement.style.display = 'block';
        }

        function resetGame() {
            document.querySelectorAll('.guard, .keycard').forEach(el => el.remove());
            gameOverElement.style.display = 'none';
            startGame();
        }

        function startGame() {
            if (isGameRunning) return;
            isGameRunning = true;
            score = 0;
            keycards = 0;
            health = 3;
            updateStats();
            document.querySelectorAll('.guard, .keycard').forEach(el => el.remove());
            alien.style.bottom = '20px';
            alien.style.left = '50px';
            gameOverElement.style.display = 'none';
            
            requestAnimationFrame(gameLoop);
            guardInterval = setInterval(createGuard, 2000);
            keycardInterval = setInterval(createKeycard, 3000);
        }

        // Event listeners
        document.addEventListener('keydown', e => {
            keys[e.code] = true;
            if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight', ' '].includes(e.code)) {
                e.preventDefault();
            }
        });
        document.addEventListener('keyup', e => keys[e.code] = false);

        // Mobile touch controls
        let touchStartX = 0;
        gameContainer.addEventListener('touchstart', e => {
            touchStartX = e.touches[0].clientX;
            if (e.touches[0].clientY < window.innerHeight / 2) {
                keys.ArrowUp = true;
            }
        });

        gameContainer.addEventListener('touchmove', e => {
            const touchX = e.touches[0].clientX;
            if (touchX < touchStartX - 30) {
                keys.ArrowLeft = true;
                keys.ArrowRight = false;
            } else if (touchX > touchStartX + 30) {
                keys.ArrowRight = true;
                keys.ArrowLeft = false;
            }
        });

        gameContainer.addEventListener('touchend', () => {
            keys.ArrowUp = false;
            keys.ArrowLeft = false;
            keys.ArrowRight = false;
        });
    </script>
</body>
</html>
